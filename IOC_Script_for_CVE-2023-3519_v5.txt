IOC Script for CVE-2023-3519  - CONFIDENTIAL - SUBJECT TO NDA - REDISTRIBUTION NOT PERMITTED

On July 18, 2023, Cloud Software Group published a Security Bulletin of Critical severity (CVE-2023-3519) for NetScaler ADC (formerly Citrix ADC) and NetScaler Gateway (formerly Citrix Gateway). If exploited, CVE-2023-3519Â  could result in unauthenticated remote code execution. Exploits of CVE-2023-3519 on unmitigated appliances have been observed. As a result, Cloud Software Group has developed Indicator of Compromise (IOC) script below to help organizations determine if they are potentially compromised:

Please note that this guidance does not represent all techniques, tactics, or procedures (TTPs) threat actors may use when targeting these environments.  Threat actors change TTPs and infrastructure frequently, and therefore this script and potential IOCs may be of limited to no forensic value.  You are strongly advised to retain the services of experienced forensic investigators to assess your environment. 

CONFIDENTIAL INFORMATION
This document and the information contained in it is the confidential and proprietary information of Cloud Software Group, Inc. and is subject to the terms and conditions of the applicable confidentiality agreement(s) in place between the recipient of this document and Cloud Software Group, Inc. Neither this document nor the information contained herein may be reproduced, redistributed, or transmitted to any third party in any form or any means without the express prior written permission of Cloud Software Group, Inc. 

DISCLAIMER
This document and the information contained in it is provided as-is. Cloud Software Group, Inc. makes no warranties or representations, whether express or implied, regarding the document or its contents, including, without limitation, that this document or the information contained in it, is error-free or meets any conditions of merchantability or fitness for a particular purpose. 



#!/bin/sh

RESULT=
T1=$(find /var/nsproflog/ -type f -iname '*.php' -exec ls -al {} \; 2>/dev/null)
T2=$(find /netscaler/ns_gui/ -type f -iname '*.php' -not -path "/netscaler/ns_gui/admin_ui/*" -exec ls -al {} \; 2>/dev/null)
T3=$(grep -a "Graceful" /var/log/httperror.log 2>/dev/null | egrep -a -v ":00:|:01:" | cat -v)
T4=$(gzcat /var/log/httperror.log.* 2>/dev/null | grep -a Graceful | egrep -a -v ":00:|:01:" | cat -v)
T5=$(pgrep -i nsppe | xargs -I% sh -c 'lsof -p % 2>/dev/null| egrep -q "PIPE" && echo "%: suspicious pipe"')
T6=$(find /var/vpn -type f -iname '*.php' -exec ls -al {} \; 2>/dev/null)
T7=$(find /var/netscaler/logon -type f -iname '*.php' -exec ls -al {} \; 2>/dev/null)
T8=$(find /var/netscaler/gui -type f -iname '*.php' -not -path '/var/netscaler/gui/admin_ui/*' -exec ls -al {} \; 2>/dev/null)
T9=$(find /netscaler/portal -type f -iname '*.php' -exec ls -al {} \; 2>/dev/null)
[ -z "$T1" ] || RESULT="$T1\n"
[ -z "$T2" ] || RESULT="$RESULT$T2\n"
[ -z "$T3" ] || RESULT="$RESULT$T3\n"
[ -z "$T4" ] || RESULT="$RESULT$T4\n"
[ -z "$T5" ] || RESULT="$RESULT$T5\n"
[ -z "$T6" ] || RESULT="$RESULT$T6\n"
[ -z "$T7" ] || RESULT="$RESULT$T7\n"
[ -z "$T8" ] || RESULT="$RESULT$T8\n"
[ -z "$T9" ] || RESULT="$RESULT$T9\n"
[ -z "$RESULT" ] || RESULT="$RESULT$(ps auxd)\n$(sysctl -a netscaler.version kern.boottime)"
[ -z "$RESULT" ] || echo -e "$RESULT\n!! Scan identified one or more IOCs"
[ -n "$RESULT" ] || echo "Scan OK"
